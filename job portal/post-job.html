<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Post Jobs</title>
  <link rel="icon" type="image/png" href="Images/icon.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <style>
    body {
      background: url("Images/postjob.jpeg") center/cover no-repeat fixed;
      font-family: 'Gill Sans', 'Gill Sans MT', Calibri, sans-serif;
    }
    .background-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.688);
      z-index: 0;
    }
    .content {
      position: relative;
      z-index: 1;
    }
    button {
      background: linear-gradient(to right, #4B3621, #A9746E);
      color: #fff;
      border: none;
      padding: 0.7rem 1.5rem;
      border-radius: 5px;
      font-weight: bold;
      width: 100%;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover {
      box-shadow: 0 4px 12px rgba(75,54,33,0.4);
      transform: scale(1.02);
    }
    .btn-coffee {
      background: linear-gradient(to right, #4B3621, #A9746E);
      color: #fff; border: none; font-weight: 500;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .btn-coffee:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(75, 54, 33, 0.4);
    }
    .btn-coffee i { 
      vertical-align: middle; 
    }
    .fixed-btn {
      position: fixed;
      bottom: 130px;
      padding: 10px 20px;
      border-radius: 20px;
      font-weight: bold;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
    }
    .back-btn {
      left: 20px;
      background-color: #8d6e63;
    }
    #btn2 {
      right: 40px;
      border-radius: 30px;
      background: linear-gradient(to right, #5a3f36, #b46e63);
      transition: background 0.3s ease;
    }
    #btn2:hover {
      background: linear-gradient(to right, #4a332c, #a85d54);
    }
    .text-white span {
      color: blanchedalmond;
      font-size: 0.9rem;
    }
    select.form-control {
        height: calc(2.25rem + 2px); /* Match input height */
    }

  </style>
</head>
<body>

<div class="background-overlay"></div>
<div class="content">
  <div class="container my-4">
    <h2 class="text mb-4" style="font-family: Verdana, Geneva, Tahoma, sans-serif; color: #fff;"><strong>POST YOUR JOBS HERE</strong></h2>

    <div class="card bg-transparent border-light text-white">
      <div class="card-header bg-transparent border-light">Add New Job</div>
      <div class="card-body">
        <form id="jobForm">
          
          <div class="row mb-3">
            <div class="col-md-4">
              <input type="text" class="form-control" id="title" placeholder="Job Title" required>
              <span id="titleError" style="color:blanchedalmond"></span>
            </div>
            <div class="col-md-4">
              <input type="text" class="form-control" id="company" placeholder="Company Name" readonly required>
              <span id="companyError" style="color:blanchedalmond"></span>
            </div>
            <div class="col-md-4">
              <input type="text" class="form-control" id="location" placeholder="Location" required>
              <span id="locationError" style="color:blanchedalmond"></span>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <input type="number" class="form-control" id="salary" placeholder="Salary (e.g., 70000)" required>
              <span id="salaryError" style="color:blanchedalmond"></span>
            </div>
            <div class="col-md-6">
              <input type="text" class="form-control" id="contact" placeholder="Address and Contact" required>
              <span id="contactError" style="color:blanchedalmond"></span>
            </div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <select class="form-control" id="type" required>
                <option value="">Select Job Type</option>
                <option value="Full-time">Full-time</option>
                <option value="Part-time">Part-time</option>
                <option value="Remote">Remote</option>
                <option value="Internship">Internship</option>
              </select>
              <span id="typeError" style="color:blanachedalmond"></span>
            </div>
            <div class="col-md-6">
              <select class="form-control" id="category" required>
                <option value="">Select Category</option>
                <option value="Technology">Technology</option>
                <option value="Design">Design</option>
                <option value="Analytics">Analytics</option>
                <option value="Sales">Sales & Marketing</option>
                <option value="Finance">Finance</option>
              </select>
              <span id="categoryError" style="color:blanachedalmond"></span>
            </div>
          </div>


          <div class="mb-3">
            <textarea class="form-control" id="description" rows="4" placeholder="Job Description" required></textarea>
            <span id="descriptionError" style="color:blanchedalmond"></span>
          </div>
          
          <div class="mb-3">
            <textarea class="form-control" id="requirements" rows="3" placeholder="Key Requirements (e.g., 3+ years experience, JavaScript, Figma)" required></textarea>
            <span id="requirementsError" style="color:blanchedalmond"></span>
          </div>

          <button type="submit" class="btn btn-light text-white">Add Job</button>
        </form>
      </div>
    </div>

    <a href="index.html" class="btn btn-coffee fixed-btn back-btn">
      <i class="bi bi-arrow-left-circle me-2"></i>Back To Home
    </a>

    <a href="posted-jobs.html" id="btn2" class="btn btn-coffee fixed-btn" style="left: auto;">
      <i class="bi bi-journal-check me-2"></i>Posted Jobs
    </a>
  </div>
</div>

<script>
  // --- ROLE AUTHORIZATION CHECK ---
  const currentUser = JSON.parse(localStorage.getItem('currentUser'));

  // Redirect if not logged in or not a Company
  if (!currentUser || currentUser.role !== 'company') {
      alert('You must be logged in as a Company to post a job.');
      window.location.href = 'login.html';
  }

  // Auto-fill company name and make it readonly
  document.addEventListener('DOMContentLoaded', function() {
      if (currentUser && currentUser.role === 'company' && currentUser.profile?.companyName) {
          document.getElementById('company').value = currentUser.profile.companyName;
          document.getElementById('company').setAttribute('readonly', true);
      }
  });
  // --- END AUTHORIZATION CHECK ---


  document.getElementById("jobForm").addEventListener("submit", function (e) {
  e.preventDefault();

  // get field values
  const title = document.getElementById("title").value.trim();
  const company = document.getElementById("company").value.trim();
  const location = document.getElementById("location").value.trim();
  const salary = document.getElementById("salary").value.trim();
  const contact = document.getElementById("contact").value.trim();
  const description = document.getElementById("description").value.trim();
  const requirements = document.getElementById("requirements").value.trim(); 
  const type = document.getElementById("type").value; 
  const category = document.getElementById("category").value; 

  let isValid = true;

  // Clear previous errors
  document.querySelectorAll('span[id$="Error"]').forEach(span => span.textContent = '');

  // Validation
  const fields = {
    title, company, location, salary, contact, description, requirements, type, category
  };

  for (const key in fields) {
    if (fields[key] === "" || fields[key] === null) {
      document.getElementById(key + "Error").textContent = `Please enter the ${key.replace(/([A-Z])/g, ' $1').toLowerCase()} field.`;
      isValid = false;
    }
  }

  // if valid save to localStorage
  if (isValid) {
    const job = {
      id: Date.now(),
      title,
      company,
      location,
      salary,
      contact,
      description,
      requirements, 
      type, 
      category, 
      postedBy: currentUser.id 
    };

    let jobs = JSON.parse(localStorage.getItem("jobs")) || [];
    jobs.push(job);
    localStorage.setItem("jobs", JSON.stringify(jobs));

    alert("Job posted successfully!");
    this.reset();
  }
});

// Add input/change event listeners to clear errors on user interaction
['title', 'company', 'location', 'salary', 'contact', 'description', 'requirements', 'type', 'category'].forEach(id => {
    document.getElementById(id).addEventListener(id.includes('select') ? "change" : "input", () => {
        const errorId = id + "Error";
        if (document.getElementById(errorId)) {
            document.getElementById(errorId).textContent = "";
        }
    });
});
</script>

</body>
</html>